name: Kakaowork Lunch Vote

on:
  schedule:
    # í‰ì¼ ì˜¤ì „ 10:00 KST (UTC 01:00)
    - cron: '0 1 * * 1-5'

    # ğŸ” í…ŒìŠ¤íŠ¸ìš©: ì˜¤ëŠ˜ 11:45 KST (UTC 02:45)
    # â€» í™•ì¸ í›„ ì´ ì¤„ì€ ê¼­ ì‚­ì œ!
    - cron: '45 2 * * 1-5'

  workflow_dispatch:

jobs:
  send-lunch-vote:
    runs-on: ubuntu-latest

    steps:
      - name: Log trigger time
        run: |
          echo "ğŸš€ Workflow triggered"
          echo "UTC time: $(date -u)"
          echo "KST time: $(TZ=Asia/Seoul date)"

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pytz

      - name: Send KakaoWork message
        env:
          KAKAOWORK_WEBHOOK_URL: ${{ secrets.KAKAOWORK_WEBHOOK_URL }}
        run: |
          python << 'EOF'
          import os
          import requests
          from datetime import datetime
          import pytz

          webhook_url = os.getenv("KAKAOWORK_WEBHOOK_URL")
          if not webhook_url:
              raise Exception("KAKAOWORK_WEBHOOK_URL is not set")

          kst = pytz.timezone("Asia/Seoul")
          now = datetime.now(kst).strftime("%Y-%m-%d %H:%M")

          payload = {
              "text": f"ğŸ± ì ì‹¬ íˆ¬í‘œ ì•Œë¦¼ (í…ŒìŠ¤íŠ¸ í¬í•¨)\n({now})\n\n1ï¸âƒ£ í•œì‹\n2ï¸âƒ£ ì–‘ì‹\n3ï¸âƒ£ ì¤‘ì‹\n4ï¸âƒ£ ììœ ì‹"
          }

          res = requests.post(webhook_url, json=payload)
          print("status:", res.status_code)
          print("response:", res.text)

          if res.status_code != 200:
              raise Exception("Failed to send KakaoWork message")
          EOF
